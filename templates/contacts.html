{% extends "base.html" %}

{% block content %}
<!-- Main container for the entire page, using flexbox for side-by-side layout -->
<div class="flex flex-col md:flex-row min-h-screen bg-gray-50 text-gray-800">

    <!-- Sidebar with animation and responsive design -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 flex-shrink-0 bg-white p-4 border-r border-gray-200 transform -translate-x-full md:translate-x-0 md:relative md:flex md:flex-col transition-transform duration-300 ease-in-out">
        <div class="flex flex-col space-y-4">
            <div class="flex items-center space-x-2 text-xl font-bold text-gray-900 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                    <path d="M17 18a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2"></path>
                    <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                    <circle cx="12" cy="10" r="2"></circle>
                    <line x1="8" y1="2" x2="8" y2="4"></line>
                    <line x1="16" y1="2" x2="16" y2="4"></line>
                </svg>
                <span>Contacts</span>
            </div>
            
            <!-- Create Contact button -->
            <button id="open-create-contact-modal" class="flex items-center space-x-3 px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-full shadow-md transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <span>Create contact</span>
            </button>

            <!-- Sidebar Navigation links -->
            <nav class="space-y-1">
                <a href="#" class="flex items-center space-x-3 px-4 py-2 rounded-lg bg-blue-100 text-blue-700 font-semibold transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Contacts</span>
                    <span class="ml-auto text-sm font-normal bg-blue-200 text-blue-700 px-2 rounded-full">{{ contacts|length }}</span>
                </a>
                <a href="#" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Frequent</span>
                </a>
                <!-- Other static links -->
                <div class="border-t border-gray-200 my-4"></div>
                <a href="#" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <path d="M4 14.899A7 7 0 0 1 15.5 9h1.5a6 6 0 0 1 0 12H4a4 4 0 0 1 0-8h.5"></path>
                    </svg>
                    <span>Merge & fix</span>
                </a>
                <a href="#" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <path d="M12 16v-6"></path>
                        <path d="M12 2v4"></path>
                        <path d="M15 11l-3-3-3 3"></path>
                        <rect x="3" y="18" width="18" height="4" rx="1"></rect>
                    </svg>
                    <span>Import</span>
                </a>
                <a href="{{ url_for('trash_page') }}" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <path d="M3 6h18"></path>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                        <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    <span>Trash</span>
                </a>
                <a href="{{ url_for('logout') }}" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-red-600 hover:bg-red-50 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span>Logout</span>
                </a>
            </nav>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-grow flex flex-col p-6">
        <!-- Top bar with search and user actions -->
        <div class="flex items-center justify-between bg-white p-4 rounded-xl shadow-sm mb-6 sticky top-0 z-10">
            <!-- Menu button for mobile and small screens -->
            <button id="menu-button" class="md:hidden p-2 rounded-full hover:bg-gray-100 transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-gray-500">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            
            <div class="flex items-center space-x-4 w-full md:w-auto">
                <div id="search-container" class="relative flex-grow transition-all duration-300 ease-in-out">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-gray-400">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </div>
                    <input type="text" placeholder="Search" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-full bg-gray-100 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
                </div>
            </div>
            <div class="flex items-center space-x-4 ml-auto">
                <!-- User account icon -->
                <a href="#" class="relative p-2 rounded-full hover:bg-gray-100 transition-colors duration-200 group">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-gray-500">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <!-- User name tooltip -->
                    <span class="absolute right-0 top-full mt-2 w-max p-2 text-xs text-white bg-gray-800 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200">{{ session['username'] }}</span>
                </a>
            </div>
        </div>

        <!-- Contacts List Header and Content -->
        <div class="flex-grow bg-white p-6 rounded-xl shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold">Contacts ({{ contacts|length }})</h2>
                <div class="flex space-x-4">
                    <button class="text-gray-500 hover:text-gray-700 transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                            <path d="M4 14h16"></path>
                            <path d="M4 18h16"></path>
                            <path d="M10 21l2-2 2 2"></path>
                            <rect x="4" y="2" width="16" height="6" rx="2"></rect>
                        </svg>
                    </button>
                    <div class="relative group">
                        <button class="text-gray-500 hover:text-gray-700 transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Contacts Table Headers and List -->
            {% if contacts %}
                <div class="grid grid-cols-6 md:grid-cols-5 gap-x-6 py-2 px-4 text-xs font-semibold text-gray-500 border-b border-gray-200 mb-2">
                    <div class="col-span-2 md:col-span-1">Name</div>
                    <div class="col-span-2 md:col-span-1">Email</div>
                    <div class="hidden md:block">Phone number</div>
                    <div class="hidden md:block">Job title & company</div>
                    <div class="col-span-2 md:col-span-1 text-right">Actions</div>
                </div>

                {% for contact in contacts %}
                <div class="grid grid-cols-6 md:grid-cols-5 gap-x-6 items-center py-4 px-4 hover:bg-gray-50 rounded-lg transition-colors duration-200">
                    <div class="col-span-2 md:col-span-1 flex items-center space-x-4">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-medium text-sm flex-shrink-0">
                            {{ contact['Name'][0] | upper }}
                        </div>
                        <div class="flex flex-col">
                            <span class="font-medium text-gray-900">{{ contact['Name'] }}</span>
                            {% if contact['Job'] %}
                                <span class="text-xs text-gray-500">{{ contact['Job'] }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-span-2 md:col-span-1 text-sm text-gray-600 truncate">{{ contact['Email'] }}</div>
                    <div class="hidden md:block text-sm text-gray-600 truncate">{{ contact['Contact'] }}</div>
                    <div class="hidden md:block text-sm text-gray-600 truncate">
                        {% if contact['Company'] %}
                            {{ contact['Company'] }}
                        {% endif %}
                    </div>
                    <div class="col-span-2 md:col-span-1 text-right flex justify-end space-x-1">
                        <button class="open-edit-contact-modal relative p-2 rounded-full text-gray-500 hover:bg-gray-100 hover:text-blue-600 transition-colors duration-200 group" 
                                data-contact-name="{{ contact['Name'] }}" 
                                data-contact-mobile="{{ contact['Contact'] }}"
                                data-contact-email="{{ contact['Email'] }}"
                                data-contact-job="{{ contact['Job'] }}"
                                data-contact-company="{{ contact['Company'] }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                            </svg>
                            <span class="absolute top-full mt-2 left-1/2 -translate-x-1/2 w-max p-2 text-xs text-white bg-gray-800 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200">Edit</span>
                        </button>
                        <a href="{{ url_for('remove_contact', contact_name=contact['Name']) }}" class="relative p-2 rounded-full text-gray-500 hover:bg-gray-100 hover:text-red-600 transition-colors duration-200 group">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                            <span class="absolute top-full mt-2 left-1/2 -translate-x-1/2 w-max p-2 text-xs text-white bg-gray-800 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200">Remove</span>
                        </a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <!-- Empty state with PNG image -->
                <div class="flex flex-col items-center justify-center p-8 space-y-6">
                    <img src="https://ssl.gstatic.com/social/contactsui/images/emptycontacts/emptycontacts_animation_cell4.png" alt="No contacts found" class="w-64 h-64 object-contain">
                    <h3 class="text-xl font-semibold text-gray-600">No contacts yet</h3>
                    <div class="flex space-x-4 mt-4">
                        <button id="open-create-contact-modal-2" class="flex items-center space-x-2 px-4 py-2 border border-transparent text-sm font-medium rounded-full text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="8.5" cy="7" r="4"></circle>
                                <line x1="18" y1="8" x2="18" y2="14"></line>
                                <line x1="21" y1="11" x2="15" y2="11"></line>
                            </svg>
                            <span>Create contact</span>
                        </button>
                        <a href="#" class="flex items-center space-x-2 px-4 py-2 border border-transparent text-sm font-medium rounded-full text-gray-700 bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-300 transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            <span>Import contacts</span>
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </main>
</div>

<!-- Modal for creating a new contact -->
<div id="create-contact-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center hidden z-[100]">
    <div class="relative mx-auto p-8 border w-full max-w-md shadow-lg rounded-xl bg-white">
        <h2 class="text-2xl font-semibold text-center text-gray-900 mb-6">Create New Contact</h2>
        
        <form action="{{ url_for('create_contact') }}" method="post" class="space-y-4">
            <div>
                <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                <div class="mt-1">
                    <input type="text" id="name" name="name" required class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>
            
            <div>
                <label for="mobile" class="block text-sm font-medium text-gray-700">Mobile Number</label>
                <div class="mt-1">
                    <input type="text" id="mobile" name="mobile" pattern="\d{10}" title="Must be a 10-digit number" class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>
            
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                <div class="mt-1">
                    <input type="email" id="email" name="email" class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>

            <!-- New fields for Job Title and Company -->
            <div>
                <label for="job_title" class="block text-sm font-medium text-gray-700">Job Title</label>
                <div class="mt-1">
                    <input type="text" id="job_title" name="job_title" class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>

            <div>
                <label for="company" class="block text-sm font-medium text-gray-700">Company</label>
                <div class="mt-1">
                    <input type="text" id="company" name="company" class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>

            <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                Add Contact
            </button>
            <button type="button" id="close-create-contact-modal" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-200 transition-colors duration-200">
                Cancel
            </button>
        </form>
    </div>
</div>

<!-- Modal for editing a contact -->
<div id="edit-contact-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center hidden z-[100]">
    <div class="relative mx-auto p-8 border w-full max-w-md shadow-lg rounded-xl bg-white">
        <h2 class="text-2xl font-semibold text-center text-gray-900 mb-6">Modify Contact</h2>
        
        <form id="edit-contact-form" action="{{ url_for('edit_contact', contact_name='__contact_name__') }}" method="post" class="space-y-4">
            <input type="hidden" id="edit-old-contact-name" name="old_contact_name">
            
            <div>
                <label for="edit-fname" class="block text-sm font-medium text-gray-700">First Name</label>
                <div class="mt-1">
                    <input type="text" id="edit-fname" name="fname" required class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>

            <div>
                <label for="edit-lname" class="block text-sm font-medium text-gray-700">Last Name</label>
                <div class="mt-1">
                    <input type="text" id="edit-lname" name="lname" class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>
            
            <div>
                <label for="edit-mobile" class="block text-sm font-medium text-gray-700">Mobile Number</label>
                <div class="mt-1">
                    <input type="text" id="edit-mobile" name="mobile" pattern="\d{10}" title="Must be a 10-digit number" class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>
            
            <div>
                <label for="edit-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                <div class="mt-1">
                    <input type="email" id="edit-email" name="email" class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>

            <div>
                <label for="edit-job-title" class="block text-sm font-medium text-gray-700">Job Title</label>
                <div class="mt-1">
                    <input type="text" id="edit-job-title" name="job_title" class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>

            <div>
                <label for="edit-company" class="block text-sm font-medium text-gray-700">Company</label>
                <div class="mt-1">
                    <input type="text" id="edit-company" name="company" class="block w-full px-4 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200">
                </div>
            </div>

            <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                Save Changes
            </button>
            <button type="button" id="close-edit-contact-modal" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-200 transition-colors duration-200">
                Cancel
            </button>
        </form>
    </div>
</div>

<script>
    // This script handles the toggle functionality for the sidebar and search bar
    document.addEventListener('DOMContentLoaded', function() {
        const sidebar = document.getElementById('sidebar');
        const menuButton = document.getElementById('menu-button');
        const searchContainer = document.getElementById('search-container');
        let isSidebarOpen = window.innerWidth >= 768; // Start open on medium screens and larger

        // Function to toggle the sidebar's state
        function toggleSidebar() {
            if (isSidebarOpen) {
                // If open, close it
                sidebar.classList.add('-translate-x-full');
                sidebar.classList.remove('translate-x-0');
                searchContainer.classList.remove('md:w-auto');
                searchContainer.classList.add('w-full');
            } else {
                // If closed, open it
                sidebar.classList.remove('-translate-x-full');
                sidebar.classList.add('translate-x-0');
                searchContainer.classList.add('md:w-auto');
                searchContainer.classList.remove('w-full');
            }
            isSidebarOpen = !isSidebarOpen;
        }

        // Event listener for the menu button
        menuButton.addEventListener('click', toggleSidebar);

        // Close sidebar if the screen size is small
        if (window.innerWidth < 768) {
            sidebar.classList.add('-translate-x-full');
            isSidebarOpen = false;
        }

        // Update sidebar state on window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768 && !isSidebarOpen) {
                sidebar.classList.remove('-translate-x-full');
                sidebar.classList.add('translate-x-0');
                searchContainer.classList.add('md:w-auto');
                searchContainer.classList.remove('w-full');
                isSidebarOpen = true;
            }
            if (window.innerWidth < 768 && isSidebarOpen) {
                 sidebar.classList.add('-translate-x-full');
                 sidebar.classList.remove('translate-x-0');
                 searchContainer.classList.remove('md:w-auto');
                 searchContainer.classList.add('w-full');
                 isSidebarOpen = false;
            }
        });

        // Create Contact Modal functionality
        const createContactModal = document.getElementById('create-contact-modal');
        const openCreateContactModalBtn = document.getElementById('open-create-contact-modal');
        const closeCreateContactModalBtn = document.getElementById('close-create-contact-modal');
        const openCreateContactModalBtn2 = document.getElementById('open-create-contact-modal-2');

        openCreateContactModalBtn.addEventListener('click', () => {
            createContactModal.classList.remove('hidden');
        });
        if (openCreateContactModalBtn2) {
            openCreateContactModalBtn2.addEventListener('click', () => {
                createContactModal.classList.remove('hidden');
            });
        }
        closeCreateContactModalBtn.addEventListener('click', () => {
            createContactModal.classList.add('hidden');
        });

        // Edit Contact Modal functionality
        const editContactModal = document.getElementById('edit-contact-modal');
        const closeEditContactModalBtn = document.getElementById('close-edit-contact-modal');
        const editContactForm = document.getElementById('edit-contact-form');

        // Loop through all edit buttons to add event listeners
        const editButtons = document.querySelectorAll('.open-edit-contact-modal');
        editButtons.forEach(button => {
            button.addEventListener('click', () => {
                const contactName = button.dataset.contactName;
                const contactMobile = button.dataset.contactMobile;
                const contactEmail = button.dataset.contactEmail;
                const contactJob = button.dataset.contactJob;
                const contactCompany = button.dataset.contactCompany;
                
                // Populate the modal fields
                const nameParts = contactName.split(' ', 2);
                document.getElementById('edit-fname').value = nameParts[0] || '';
                document.getElementById('edit-lname').value = nameParts[1] || '';
                document.getElementById('edit-mobile').value = contactMobile || '';
                document.getElementById('edit-email').value = contactEmail || '';
                document.getElementById('edit-job-title').value = contactJob || '';
                document.getElementById('edit-company').value = contactCompany || '';
                document.getElementById('edit-old-contact-name').value = contactName;

                // Update the form action URL
                editContactForm.action = `/edit_contact/${encodeURIComponent(contactName)}`;
                
                editContactModal.classList.remove('hidden');
            });
        });

        closeEditContactModalBtn.addEventListener('click', () => {
            editContactModal.classList.add('hidden');
        });

        // Close any modal if the user clicks outside of it
        window.addEventListener('click', (event) => {
            if (event.target === createContactModal) {
                createContactModal.classList.add('hidden');
            }
            if (event.target === editContactModal) {
                editContactModal.classList.add('hidden');
            }
        });
    });
</script>
{% endblock %}
